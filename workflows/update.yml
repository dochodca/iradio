name: Update feed

on:
  schedule:
    - cron: '0 * * * *'  # Každú hodinu
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Generate feed
        run: |
          TIME=$(date +"%a, %d %b %Y %H:%M:%S %z")
          GUID="cro-dvojka-$(date +'%Y%m%d%H')"
          cat > feed.rss <<EOL
<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
<channel>
    <title>ČRo Dvojka – Live</title>
    <link>https://dvojka.rozhlas.cz</link>
    <description>Živý stream stanice Český rozhlas Dvojka cez Spotify</description>
    <language>cs</language>
    <image>
        <url>https://upload.wikimedia.org/wikipedia/commons/6/63/Cesky_rozhlas_logo.svg</url>
        <title>ČRo Dvojka – Live</title>
        <link>https://dvojka.rozhlas.cz</link>
    </image>

    <item>
        <title>Živý prenos ${TIME}</title>
        <description>Poslouchejte živý přenos Českého rozhlasu Dvojka</description>
        <enclosure url="http://www.play.cz/radio/cro2-128.mp3.m3u" length="0" type="audio/mpeg"/>
        <guid>${GUID}</guid>
        <pubDate>${TIME}</pubDate>
    </item>
</channel>
</rss>
EOL
      - name: Commit and push
        run: |
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions"
          git add feed.rss
          git commit -m "Auto-update feed"
          git push
